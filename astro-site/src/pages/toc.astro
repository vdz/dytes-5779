---
import Layout from '../layouts/Layout.astro';
import { getAllPages } from '../lib/contentful';

export const prerender = true;

const pages = await getAllPages();
const parts = {};
const titles = {};

pages.forEach(page => {
  const part = page.part;
  if (!titles[part]) titles[part] = page.title;
  if (!parts[part]) parts[part] = [];
  parts[part].push(page);
});

const sortedParts = Object.keys(parts).sort((a, b) => parseInt(a) - parseInt(b));
---

<Layout title="תוכן העניינים">
  <main style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <header style="text-align: center; padding: 20px 0; border-bottom: 2px solid #ddd; margin-bottom: 30px;">
      <h1>תוכן העניינים</h1>
      <nav style="margin-top: 10px;"><a href="/">← לדף הנוכחי</a></nav>
    </header>

    <div style="display: flex; flex-direction: column; gap: 30px;">
      {sortedParts.map(part => (
        <section style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
          <h2 style="font-size: 1.5rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #0066cc; color: #0066cc;">
            חלק {part}: {titles[part]}
          </h2>
          <ul style="list-style: none; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 10px;">
            {parts[part].map(page => (
              <li style="border-bottom: 1px solid #eee;">
                <a href={`/page/${page.index}`} style="display: flex; align-items: center; gap: 10px; padding: 10px;">
                  <span style="font-weight: bold; color: #0066cc; min-width: 40px;">{page.index}</span>
                  <span style="flex: 1;">{page.title}</span>
                  <span style="color: #666; font-size: 0.85rem;">{page.subject}</span>
                </a>
              </li>
            ))}
          </ul>
        </section>
      ))}
    </div>

    <footer style="text-align: center; padding: 30px; color: #666; border-top: 1px solid #ddd; margin-top: 40px;">
      <p>© 2024 הדף היומי בתלמוד עשר הספירות</p>
    </footer>
  </main>
</Layout>
